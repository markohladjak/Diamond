<html>
<head>
    <!-- <link rel="stylesheet" href="src/css/general.css"> -->
	<link rel="stylesheet" href="src/css/status.css">

</head>
<style>
    html {
        padding: 40px;

        font-family: 'Helvetica Neue';
        font-style: normal;
        font-weight: bold;

        color: #FFFFFF;
    }

    .scheme-container {
        position: relative;
        width: 100%;
        padding-top: 58.5%;
    }

    .scheme {
        display: grid;
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        height: 100%;

        grid-template-columns: 16% auto 55% auto 16%;

        /* width: 1086px;
        height: 635px; */
    }

    .col-l {
        display: grid;
        grid-template-rows: 19.5% 05% 19.5% 08% 19.5% 19.5% auto;
    }

    .col-m {
        display: grid;
        grid-template-columns: repeat(6, auto);
        grid-template-rows: 13% 19.5% 19.5% auto 19.5%;
    }

    .col-r {
        display: grid;
        grid-template-rows: 19.5% 19.5% 19.5% 19.5% auto;
    }

    .dev-place {
        height: 100%;
    }

    .device {
        display: grid;
        box-sizing: border-box;
        grid-template-rows: auto auto auto;

        height: 100%;

        background: #33333C;
        border: 1px solid rgba(255, 255, 255, 0.16);
        box-shadow: 0px 24px 32px rgba(0, 0, 0, 0.04), 0px 16px 24px rgba(0, 0, 0, 0.04), 0px 4px 8px rgba(0, 0, 0, 0.04), 0px 0px 1px rgba(0, 0, 0, 0.04);
        border-radius: 15px;
    }

    .scheme span {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .dv-palace-name {
        font-size: 38px;
        /* line-height: 45px; */
    }

    .dv-place-info {
        font-weight: 500;
        font-size: 16px;

        color: #C1C5D2;
    }

    .dv-palace-state {
        font-weight: 500;
        font-size: 20px;

        display: flex;
        justify-content: center;
        align-items: center;
        
        width: auto;
    }

    .disconnected {
        filter: grayscale();
        opacity: 0.5;
    }

    .dot {
        margin: 0 8px 0 0;
    }
</style>

<body>
    <div class="scheme-container">
        <div class="scheme">
            <div class="col-l">
                <div class="dev-place">
                    <template id="sc_device_template">
                        <div class="device">
                            <span class="dv-palace-name">Lift 1</span>
                            <span class="dv-place-info">Washing</span>
                            <div class="deviceStatus dv-palace-state dvsNONE" onclick="parent.showActionPanel(this, event);">
                                <span class="dot"></span>
                                <span class="deviceStatusText">None</span>
                            </div>
                        </div>
                    </template>
                </div>
                <div></div>
                <div class="dev-place"></div>
                <div></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div></div>
            </div>
            <div></div>
            <div class="col-m">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>

                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>

                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>

                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
            </div>
            <div></div>
            <div class="col-r">
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div class="dev-place"></div>
                <div></div>
            </div>
        </div>
    </div>

    <script>
        var placeNames = [  ["22", "Washing"], ["21", "Lift"], ["20", "Lift"], ["19", "Lift"], 
                            ["18", "Lift"], ["17", "Lift"], ["16", "Lift"], ["15", "Lift"], ["14", "Lift"], ["13", "Lift"], 
                            ["7", "Lift"], ["8", "Lift"], ["9", "Lift"], ["10", "Lift"], ["11", "Lift"], ["12", "Lift"], 
                            ["6", "Lift"], ["5", "Lift"], ["4", "Lift"], ["3", "Lift"], ["2", "Lift"], ["1", "Lift"],
                            ["28", "Washing"], ["27", "Washing"], ["26", "Washing"], ["25", "Geometry"]];

        function fill_scheme() {
            let template = document.querySelector('#sc_device_template');
    
            let dv = template.content.querySelector(".device");

            let devPlaces = document.getElementsByClassName('dev-place');

            let name = dv.getElementsByClassName("dv-palace-name")[0];
            let descr = dv.getElementsByClassName("dv-place-info")[0]; 

            for (let i = 0; i < devPlaces.length; ++i) {
                name.textContent = placeNames[i][0];
                descr.textContent = placeNames[i][1];

                devPlaces[i].appendChild(document.importNode(dv, true));
            }

                // console.log("dev", devPlaces);

            // [devPlaces].forEach(element => {
            //     element.appendChild(deviceView);
            // });
        }
    
        function setDeviceInfo(info) {
            let dv = document.getElementById(info.id);

            let dvStatus = dv.getElementsByClassName("deviceStatus")[0];
            let statusText = dv.getElementsByClassName("deviceStatusText")[0];

            dvStatus.className = dvStatus.className.replace(/dvs[A-Z]+/g, "dvs" + info.state.toUpperCase());
                        
            statusText.textContent = info.state;
        }

        function UpdateScheme() {
            console.log("UpdateScheme");

            let dvList = parent.document.getElementsByClassName("deviceView");
            let schemeDevices = document.getElementsByClassName('device');

            [].forEach.call(schemeDevices, (place) => {
                let placeName = place.querySelector('.dv-place-info').textContent + ' ' + 
                                place.querySelector('.dv-palace-name').textContent;

                let i;
                for ( i = 0; i < dvList.length; i++) {
                    let dv = dvList[i];
                    let name = dv.getElementsByClassName("deviceName")[0].value;

                    if (name == placeName) {
                        place.id = dv.id;
                        let status = dv.getElementsByClassName("deviceStatusText")[0].textContent;

                        setDeviceInfo({ 'id': dv.id, 'state': status });

                        break;
                    }
                }
                
                place.classList.toggle("disconnected", i >= dvList.length);
            });
        }

        fill_scheme();
    </script>
    
</body>
</html>