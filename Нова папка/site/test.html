<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Diamond</title>


  <style>
    @media only screen and (max-width: 600px) {
      body {
        background-color: rgb(211, 24, 49);
      }

      #plan {
        height: 400px;
        width: auto;
        object-fit: fill;

      }
    }

    @media only screen and (min-width: 600px) {
      #plan {
        height: auto;
        width: 100%;
        object-fit: contain;
      }
    }

    #b1 {
      position: absolute;
      left: 666px;
      top: 640px;
      /* z-index: -1; */
    }
  </style>



</head>

<body>
  <div class="container">

    <nav class="navbar navbar-dark bg-dark">
      <span class="navbar-brand mb-0 h1">TOYOTA</span>
    </nav>

    <div class="accordion" id="accordionExample">
      <div class="card">
        <div class="card-header" id="headingOne">
          <h2 class="mb-0">
            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse"
              data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
              Список
            </button>
          </h2>
        </div>

        <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
          <div class="card-body">


            <table class="table table-striped table-dark">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Стан</th>
                  <th scope="col">Блок</th>
                </tr>
              </thead>

              <div id="postViewContainer"></div>

              <!-- <tr>
                <th scope="row">1</th> 
                <td>
                  <button class='btn-success' type="button" id="work#" onClick="onWork()">Робота</button>
                  <button class='btn-warning' type="button" id="done#" onClick="onDone()">Готово</button>
                  <button class='btn-primary' type="button" id="free#" onClick="onFree()">Вільно</button>
                  <button class='btn-danger' type="button" id="sos#" onClick="onSos()">Sos</button>
                </td>
                <td>
                  <button class="" type="button" onClick="toggleActive()">Вкл.</button>
                </td>
              </tr> -->

              <!-- <tr>
                <th scope="row">2</th>
                <td>
                  <button class="badge  'btn-success'" type="button" id="work#" onClick="onWork()">Робота</button>
                  <button class="badge  'btn-warning'" type="button" id="done#" onClick="onDone()">Готово</button>
                  <button class="badge  'btn-primary'" type="button" id="free#" onClick="onFree()">Вільно</button>
                  <button class="badge  'btn-danger'" type="button" id="sos#" onClick="onSos()">Sos</button>
                </td>
                <td>
                  <button class="badge " type="button" onClick="toggleActive()">Вкл.</button>
                </td>
              </tr>


              <tr>
                <th scope="row">3</th>
                <td>
                  <button class="badge  'btn-success'" type="button" id="work#" onClick="onWork()">Робота</button>
                  <button class="badge  'btn-warning'" type="button" id="done#" onClick="onDone()">Готово</button>
                  <button class="badge  'btn-primary'" type="button" id="free#" onClick="onFree()">Вільно</button>
                  <button class="badge  'btn-danger'" type="button" id="sos#" onClick="onSos()">Sos</button>
                </td>
                <td>
                  <button class="badge " type="button" onClick="toggleActive()">Вкл.</button>
                </td>
              </tr> -->


            </table>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header" id="headingTwo">
          <h2 class="mb-0">
            <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse"
              data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
              План
            </button>
          </h2>
        </div>
        <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
          <div class="card-body">
            <div class="container" style="overflow-x:auto">
              <img id="plan" src="Scheme1.svg">
              <button id="b1">P.1</button>
              <div class="modal-dialog modal-xl">modal</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>











  <!-- Optional JavaScript; choose one of the two! -->

  <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
    crossorigin="anonymous"></script>

  <!-- Option 2: jQuery, Popper.js, and Bootstrap JS
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.djsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    -->
  <script>
    // var els = generatePostView(5);

    // els.forEach(el => {
    //   document.getElementById("postViewContainer").appendChild(el);
    // })

    //   console.log(httpGet("http://192.168.4.1/"));

    addDevice("1");
    addDevice("2");
    addDevice("3");
    addDevice("4");

    setDeviceState(' { "id" : "3", "state" : "Sos" } ');

    removeDevice("3");

    function generatePostView(id) {
      var radioID = "radioID" + id;

      var postText = `<div id="${id}">
                          <p><input type="radio" name="${radioID}" value="Busy" onchange="myFunction(this)"> Робота</p>
                          <p><input type="radio" name="${radioID}" value="Ready" onchange="myFunction(this)"> Готово</p>
                          <p><input type="radio" name="${radioID}" value="Free" onchange="myFunction(this)"> Вільно</p>
                          <p><input type="radio" name="${radioID}" value="Sos" onchange="myFunction(this)"> Sos</p>
                      </div>`

      var div = document.createElement('div');

      div.classList.add("postView");
      div.id = radioID;
      div.innerHTML = postText;

      return div;
    }

    function serverSendInit() {
      if (!!window.EventSource) {
        var source = new EventSource('/events');

        source.addEventListener('open', function (e) {
          console.log("Events Connected");
        }, false);

        source.addEventListener('error', function (e) {
          if (e.target.readyState != EventSource.OPEN) {
            console.log("Events Disconnected");
          }
        }, false);

        source.addEventListener('message', function (e) {
          console.log("message", e.data);
        }, false);

        source.addEventListener('msg', function (e) {
          console.log("msg", e.data);
          processMessage(e.data);
        }, false);
      }
    }

    function httpGet(theUrl) {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", theUrl, false); // false for synchronous request
      xmlHttp.send(null);
      return xmlHttp.responseText;
    }

    function processMessage(msg) {
      var m = JSON.parse(msg, function (key, value) {
        switch (key) {
          case "add": addDevice(value);
            break;
          case "rem": removeDevice(value);
            break;
          case "set": setDeviceState(value);
            break;
        }
      });
    }

    function addDevice(id) {
      var el = generatePostView(id);

      document.getElementById("postViewContainer").appendChild(el);
    }

    function removeDevice(id) {
      document.getElementById(id).remove();
    }

    function setDeviceState(msg){
      var m = JSON.parse(msg);

      var radioID = "radioID" + m.id;

      var node = document.getElementsByName(radioID).forEach( function (item) {
        if (item.value == m.state) 
          item.checked = true; 
      });

    }

    function myFunction(el) {
      console.log(el.parentElement.parentElement.id, ": ", el.value);
    }


    // Url url = new Uri(urlString);
    //NameValueCollection outer = HttpUtility.ParseQueryString(uri.Query);

    // function httpGet(theUrl)
    // {
    //     var xmlHttp = new XMLHttpRequest();
    //     xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
    //     xmlHttp.send( "a=b&c=1");
    //     return xmlHttp.responseText;
    // }
    function OnLoadHendler() {

    }
  </script>
</body>

</html>